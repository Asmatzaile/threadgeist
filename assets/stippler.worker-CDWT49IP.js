(function(){"use strict";const E=11102230246251565e-32,U=134217729,rt=(3+8*E)*E;function V(d,t,n,i,e){let s,l,h,r,a=t[0],u=i[0],o=0,c=0;u>a==u>-a?(s=a,a=t[++o]):(s=u,u=i[++c]);let f=0;if(o<d&&c<n)for(u>a==u>-a?(l=a+s,h=s-(l-a),a=t[++o]):(l=u+s,h=s-(l-u),u=i[++c]),s=l,h!==0&&(e[f++]=h);o<d&&c<n;)u>a==u>-a?(l=s+a,r=l-s,h=s-(l-r)+(a-r),a=t[++o]):(l=s+u,r=l-s,h=s-(l-r)+(u-r),u=i[++c]),s=l,h!==0&&(e[f++]=h);for(;o<d;)l=s+a,r=l-s,h=s-(l-r)+(a-r),a=t[++o],s=l,h!==0&&(e[f++]=h);for(;c<n;)l=s+u,r=l-s,h=s-(l-r)+(u-r),u=i[++c],s=l,h!==0&&(e[f++]=h);return(s!==0||f===0)&&(e[f++]=s),f}function ot(d,t){let n=t[0];for(let i=1;i<d;i++)n+=t[i];return n}function Y(d){return new Float64Array(d)}const ct=(3+16*E)*E,at=(2+12*E)*E,ut=(9+64*E)*E*E,P=Y(4),tt=Y(8),nt=Y(12),et=Y(16),L=Y(4);function ft(d,t,n,i,e,s,l){let h,r,a,u,o,c,f,g,_,b,y,p,A,k,I,S,j,v;const m=d-e,x=n-e,w=t-s,M=i-s;k=m*M,c=U*m,f=c-(c-m),g=m-f,c=U*M,_=c-(c-M),b=M-_,I=g*b-(k-f*_-g*_-f*b),S=w*x,c=U*w,f=c-(c-w),g=w-f,c=U*x,_=c-(c-x),b=x-_,j=g*b-(S-f*_-g*_-f*b),y=I-j,o=I-y,P[0]=I-(y+o)+(o-j),p=k+y,o=p-k,A=k-(p-o)+(y-o),y=A-S,o=A-y,P[1]=A-(y+o)+(o-S),v=p+y,o=v-p,P[2]=p-(v-o)+(y-o),P[3]=v;let $=ot(4,P),F=at*l;if($>=F||-$>=F||(o=d-m,h=d-(m+o)+(o-e),o=n-x,a=n-(x+o)+(o-e),o=t-w,r=t-(w+o)+(o-s),o=i-M,u=i-(M+o)+(o-s),h===0&&r===0&&a===0&&u===0)||(F=ut*l+rt*Math.abs($),$+=m*u+M*h-(w*a+x*r),$>=F||-$>=F))return $;k=h*M,c=U*h,f=c-(c-h),g=h-f,c=U*M,_=c-(c-M),b=M-_,I=g*b-(k-f*_-g*_-f*b),S=r*x,c=U*r,f=c-(c-r),g=r-f,c=U*x,_=c-(c-x),b=x-_,j=g*b-(S-f*_-g*_-f*b),y=I-j,o=I-y,L[0]=I-(y+o)+(o-j),p=k+y,o=p-k,A=k-(p-o)+(y-o),y=A-S,o=A-y,L[1]=A-(y+o)+(o-S),v=p+y,o=v-p,L[2]=p-(v-o)+(y-o),L[3]=v;const C=V(4,P,4,L,tt);k=m*u,c=U*m,f=c-(c-m),g=m-f,c=U*u,_=c-(c-u),b=u-_,I=g*b-(k-f*_-g*_-f*b),S=w*a,c=U*w,f=c-(c-w),g=w-f,c=U*a,_=c-(c-a),b=a-_,j=g*b-(S-f*_-g*_-f*b),y=I-j,o=I-y,L[0]=I-(y+o)+(o-j),p=k+y,o=p-k,A=k-(p-o)+(y-o),y=A-S,o=A-y,L[1]=A-(y+o)+(o-S),v=p+y,o=v-p,L[2]=p-(v-o)+(y-o),L[3]=v;const T=V(C,tt,4,L,nt);k=h*u,c=U*h,f=c-(c-h),g=h-f,c=U*u,_=c-(c-u),b=u-_,I=g*b-(k-f*_-g*_-f*b),S=r*a,c=U*r,f=c-(c-r),g=r-f,c=U*a,_=c-(c-a),b=a-_,j=g*b-(S-f*_-g*_-f*b),y=I-j,o=I-y,L[0]=I-(y+o)+(o-j),p=k+y,o=p-k,A=k-(p-o)+(y-o),y=A-S,o=A-y,L[1]=A-(y+o)+(o-S),v=p+y,o=v-p,L[2]=p-(v-o)+(y-o),L[3]=v;const z=V(T,nt,4,L,et);return et[z-1]}function B(d,t,n,i,e,s){const l=(t-s)*(n-e),h=(d-e)*(i-s),r=l-h,a=Math.abs(l+h);return Math.abs(r)>=ct*a?r:-ft(d,t,n,i,e,s,a)}const it=Math.pow(2,-52),G=new Uint32Array(512);class Q{static from(t,n=yt,i=bt){const e=t.length,s=new Float64Array(e*2);for(let l=0;l<e;l++){const h=t[l];s[2*l]=n(h),s[2*l+1]=i(h)}return new Q(s)}constructor(t){const n=t.length>>1;if(n>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const i=Math.max(2*n-5,0);this._triangles=new Uint32Array(i*3),this._halfedges=new Int32Array(i*3),this._hashSize=Math.ceil(Math.sqrt(n)),this._hullPrev=new Uint32Array(n),this._hullNext=new Uint32Array(n),this._hullTri=new Uint32Array(n),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(n),this._dists=new Float64Array(n),this.update()}update(){const{coords:t,_hullPrev:n,_hullNext:i,_hullTri:e,_hullHash:s}=this,l=t.length>>1;let h=1/0,r=1/0,a=-1/0,u=-1/0;for(let m=0;m<l;m++){const x=t[2*m],w=t[2*m+1];x<h&&(h=x),w<r&&(r=w),x>a&&(a=x),w>u&&(u=w),this._ids[m]=m}const o=(h+a)/2,c=(r+u)/2;let f,g,_;for(let m=0,x=1/0;m<l;m++){const w=Z(o,c,t[2*m],t[2*m+1]);w<x&&(f=m,x=w)}const b=t[2*f],y=t[2*f+1];for(let m=0,x=1/0;m<l;m++){if(m===f)continue;const w=Z(b,y,t[2*m],t[2*m+1]);w<x&&w>0&&(g=m,x=w)}let p=t[2*g],A=t[2*g+1],k=1/0;for(let m=0;m<l;m++){if(m===f||m===g)continue;const x=gt(b,y,p,A,t[2*m],t[2*m+1]);x<k&&(_=m,k=x)}let I=t[2*_],S=t[2*_+1];if(k===1/0){for(let w=0;w<l;w++)this._dists[w]=t[2*w]-t[0]||t[2*w+1]-t[1];N(this._ids,this._dists,0,l-1);const m=new Uint32Array(l);let x=0;for(let w=0,M=-1/0;w<l;w++){const $=this._ids[w],F=this._dists[$];F>M&&(m[x++]=$,M=F)}this.hull=m.subarray(0,x),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(B(b,y,p,A,I,S)<0){const m=g,x=p,w=A;g=_,p=I,A=S,_=m,I=x,S=w}const j=mt(b,y,p,A,I,S);this._cx=j.x,this._cy=j.y;for(let m=0;m<l;m++)this._dists[m]=Z(t[2*m],t[2*m+1],j.x,j.y);N(this._ids,this._dists,0,l-1),this._hullStart=f;let v=3;i[f]=n[_]=g,i[g]=n[f]=_,i[_]=n[g]=f,e[f]=0,e[g]=1,e[_]=2,s.fill(-1),s[this._hashKey(b,y)]=f,s[this._hashKey(p,A)]=g,s[this._hashKey(I,S)]=_,this.trianglesLen=0,this._addTriangle(f,g,_,-1,-1,-1);for(let m=0,x,w;m<this._ids.length;m++){const M=this._ids[m],$=t[2*M],F=t[2*M+1];if(m>0&&Math.abs($-x)<=it&&Math.abs(F-w)<=it||(x=$,w=F,M===f||M===g||M===_))continue;let C=0;for(let X=0,zt=this._hashKey($,F);X<this._hashSize&&(C=s[(zt+X)%this._hashSize],!(C!==-1&&C!==i[C]));X++);C=n[C];let T=C,z;for(;z=i[T],B($,F,t[2*T],t[2*T+1],t[2*z],t[2*z+1])>=0;)if(T=z,T===C){T=-1;break}if(T===-1)continue;let D=this._addTriangle(T,M,i[T],-1,-1,e[T]);e[M]=this._legalize(D+2),e[T]=D,v++;let K=i[T];for(;z=i[K],B($,F,t[2*K],t[2*K+1],t[2*z],t[2*z+1])<0;)D=this._addTriangle(K,M,z,e[M],-1,e[K]),e[M]=this._legalize(D+2),i[K]=K,v--,K=z;if(T===C)for(;z=n[T],B($,F,t[2*z],t[2*z+1],t[2*T],t[2*T+1])<0;)D=this._addTriangle(z,M,T,-1,e[T],e[z]),this._legalize(D+2),e[z]=D,i[T]=T,v--,T=z;this._hullStart=n[M]=T,i[T]=n[K]=M,i[M]=K,s[this._hashKey($,F)]=M,s[this._hashKey(t[2*T],t[2*T+1])]=T}this.hull=new Uint32Array(v);for(let m=0,x=this._hullStart;m<v;m++)this.hull[m]=x,x=i[x];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,n){return Math.floor(dt(t-this._cx,n-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:n,_halfedges:i,coords:e}=this;let s=0,l=0;for(;;){const h=i[t],r=t-t%3;if(l=r+(t+2)%3,h===-1){if(s===0)break;t=G[--s];continue}const a=h-h%3,u=r+(t+1)%3,o=a+(h+2)%3,c=n[l],f=n[t],g=n[u],_=n[o];if(_t(e[2*c],e[2*c+1],e[2*f],e[2*f+1],e[2*g],e[2*g+1],e[2*_],e[2*_+1])){n[t]=_,n[h]=c;const y=i[o];if(y===-1){let A=this._hullStart;do{if(this._hullTri[A]===o){this._hullTri[A]=t;break}A=this._hullPrev[A]}while(A!==this._hullStart)}this._link(t,y),this._link(h,i[l]),this._link(l,o);const p=a+(h+1)%3;s<G.length&&(G[s++]=p)}else{if(s===0)break;t=G[--s]}}return l}_link(t,n){this._halfedges[t]=n,n!==-1&&(this._halfedges[n]=t)}_addTriangle(t,n,i,e,s,l){const h=this.trianglesLen;return this._triangles[h]=t,this._triangles[h+1]=n,this._triangles[h+2]=i,this._link(h,e),this._link(h+1,s),this._link(h+2,l),this.trianglesLen+=3,h}}function dt(d,t){const n=d/(Math.abs(d)+Math.abs(t));return(t>0?3-n:1+n)/4}function Z(d,t,n,i){const e=d-n,s=t-i;return e*e+s*s}function _t(d,t,n,i,e,s,l,h){const r=d-l,a=t-h,u=n-l,o=i-h,c=e-l,f=s-h,g=r*r+a*a,_=u*u+o*o,b=c*c+f*f;return r*(o*b-_*f)-a*(u*b-_*c)+g*(u*f-o*c)<0}function gt(d,t,n,i,e,s){const l=n-d,h=i-t,r=e-d,a=s-t,u=l*l+h*h,o=r*r+a*a,c=.5/(l*a-h*r),f=(a*u-h*o)*c,g=(l*o-r*u)*c;return f*f+g*g}function mt(d,t,n,i,e,s){const l=n-d,h=i-t,r=e-d,a=s-t,u=l*l+h*h,o=r*r+a*a,c=.5/(l*a-h*r),f=d+(a*u-h*o)*c,g=t+(l*o-r*u)*c;return{x:f,y:g}}function N(d,t,n,i){if(i-n<=20)for(let e=n+1;e<=i;e++){const s=d[e],l=t[s];let h=e-1;for(;h>=n&&t[d[h]]>l;)d[h+1]=d[h--];d[h+1]=s}else{const e=n+i>>1;let s=n+1,l=i;q(d,e,s),t[d[n]]>t[d[i]]&&q(d,n,i),t[d[s]]>t[d[i]]&&q(d,s,i),t[d[n]]>t[d[s]]&&q(d,n,s);const h=d[s],r=t[h];for(;;){do s++;while(t[d[s]]<r);do l--;while(t[d[l]]>r);if(l<s)break;q(d,s,l)}d[n+1]=d[l],d[l]=h,i-s+1>=l-n?(N(d,t,s,i),N(d,t,n,l-1)):(N(d,t,n,l-1),N(d,t,s,i))}}function q(d,t,n){const i=d[t];d[t]=d[n],d[n]=i}function yt(d){return d[0]}function bt(d){return d[1]}const st=1e-6;class H{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,n){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,n){this._+=`L${this._x1=+t},${this._y1=+n}`}arc(t,n,i){t=+t,n=+n,i=+i;const e=t+i,s=n;if(i<0)throw new Error("negative radius");this._x1===null?this._+=`M${e},${s}`:(Math.abs(this._x1-e)>st||Math.abs(this._y1-s)>st)&&(this._+="L"+e+","+s),i&&(this._+=`A${i},${i},0,1,1,${t-i},${n}A${i},${i},0,1,1,${this._x1=e},${this._y1=s}`)}rect(t,n,i,e){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${+i}v${+e}h${-i}Z`}value(){return this._||null}}class R{constructor(){this._=[]}moveTo(t,n){this._.push([t,n])}closePath(){this._.push(this._[0].slice())}lineTo(t,n){this._.push([t,n])}value(){return this._.length?this._:null}}class pt{constructor(t,[n,i,e,s]=[0,0,960,500]){if(!((e=+e)>=(n=+n))||!((s=+s)>=(i=+i)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(t.points.length*2),this.vectors=new Float64Array(t.points.length*2),this.xmax=e,this.xmin=n,this.ymax=s,this.ymin=i,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:n,triangles:i},vectors:e}=this;let s,l;const h=this.circumcenters=this._circumcenters.subarray(0,i.length/3*2);for(let _=0,b=0,y=i.length,p,A;_<y;_+=3,b+=2){const k=i[_]*2,I=i[_+1]*2,S=i[_+2]*2,j=t[k],v=t[k+1],m=t[I],x=t[I+1],w=t[S],M=t[S+1],$=m-j,F=x-v,C=w-j,T=M-v,z=($*T-F*C)*2;if(Math.abs(z)<1e-9){if(s===void 0){s=l=0;for(const K of n)s+=t[K*2],l+=t[K*2+1];s/=n.length,l/=n.length}const D=1e9*Math.sign((s-j)*T-(l-v)*C);p=(j+w)/2-D*T,A=(v+M)/2+D*C}else{const D=1/z,K=$*$+F*F,X=C*C+T*T;p=j+(T*K-F*X)*D,A=v+($*X-C*K)*D}h[b]=p,h[b+1]=A}let r=n[n.length-1],a,u=r*4,o,c=t[2*r],f,g=t[2*r+1];e.fill(0);for(let _=0;_<n.length;++_)r=n[_],a=u,o=c,f=g,u=r*4,c=t[2*r],g=t[2*r+1],e[a+2]=e[u]=f-g,e[a+3]=e[u+1]=c-o}render(t){const n=t==null?t=new H:void 0,{delaunay:{halfedges:i,inedges:e,hull:s},circumcenters:l,vectors:h}=this;if(s.length<=1)return null;for(let u=0,o=i.length;u<o;++u){const c=i[u];if(c<u)continue;const f=Math.floor(u/3)*2,g=Math.floor(c/3)*2,_=l[f],b=l[f+1],y=l[g],p=l[g+1];this._renderSegment(_,b,y,p,t)}let r,a=s[s.length-1];for(let u=0;u<s.length;++u){r=a,a=s[u];const o=Math.floor(e[a]/3)*2,c=l[o],f=l[o+1],g=r*4,_=this._project(c,f,h[g+2],h[g+3]);_&&this._renderSegment(c,f,_[0],_[1],t)}return n&&n.value()}renderBounds(t){const n=t==null?t=new H:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),n&&n.value()}renderCell(t,n){const i=n==null?n=new H:void 0,e=this._clip(t);if(e===null||!e.length)return;n.moveTo(e[0],e[1]);let s=e.length;for(;e[0]===e[s-2]&&e[1]===e[s-1]&&s>1;)s-=2;for(let l=2;l<s;l+=2)(e[l]!==e[l-2]||e[l+1]!==e[l-1])&&n.lineTo(e[l],e[l+1]);return n.closePath(),i&&i.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let n=0,i=t.length/2;n<i;++n){const e=this.cellPolygon(n);e&&(e.index=n,yield e)}}cellPolygon(t){const n=new R;return this.renderCell(t,n),n.value()}_renderSegment(t,n,i,e,s){let l;const h=this._regioncode(t,n),r=this._regioncode(i,e);h===0&&r===0?(s.moveTo(t,n),s.lineTo(i,e)):(l=this._clipSegment(t,n,i,e,h,r))&&(s.moveTo(l[0],l[1]),s.lineTo(l[2],l[3]))}contains(t,n,i){return n=+n,n!==n||(i=+i,i!==i)?!1:this.delaunay._step(t,n,i)===t}*neighbors(t){const n=this._clip(t);if(n)for(const i of this.delaunay.neighbors(t)){const e=this._clip(i);if(e){t:for(let s=0,l=n.length;s<l;s+=2)for(let h=0,r=e.length;h<r;h+=2)if(n[s]===e[h]&&n[s+1]===e[h+1]&&n[(s+2)%l]===e[(h+r-2)%r]&&n[(s+3)%l]===e[(h+r-1)%r]){yield i;break t}}}}_cell(t){const{circumcenters:n,delaunay:{inedges:i,halfedges:e,triangles:s}}=this,l=i[t];if(l===-1)return null;const h=[];let r=l;do{const a=Math.floor(r/3);if(h.push(n[a*2],n[a*2+1]),r=r%3===2?r-2:r+1,s[r]!==t)break;r=e[r]}while(r!==l&&r!==-1);return h}_clip(t){if(t===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const n=this._cell(t);if(n===null)return null;const{vectors:i}=this,e=t*4;return this._simplify(i[e]||i[e+1]?this._clipInfinite(t,n,i[e],i[e+1],i[e+2],i[e+3]):this._clipFinite(t,n))}_clipFinite(t,n){const i=n.length;let e=null,s,l,h=n[i-2],r=n[i-1],a,u=this._regioncode(h,r),o,c=0;for(let f=0;f<i;f+=2)if(s=h,l=r,h=n[f],r=n[f+1],a=u,u=this._regioncode(h,r),a===0&&u===0)o=c,c=0,e?e.push(h,r):e=[h,r];else{let g,_,b,y,p;if(a===0){if((g=this._clipSegment(s,l,h,r,a,u))===null)continue;[_,b,y,p]=g}else{if((g=this._clipSegment(h,r,s,l,u,a))===null)continue;[y,p,_,b]=g,o=c,c=this._edgecode(_,b),o&&c&&this._edge(t,o,c,e,e.length),e?e.push(_,b):e=[_,b]}o=c,c=this._edgecode(y,p),o&&c&&this._edge(t,o,c,e,e.length),e?e.push(y,p):e=[y,p]}if(e)o=c,c=this._edgecode(e[0],e[1]),o&&c&&this._edge(t,o,c,e,e.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return e}_clipSegment(t,n,i,e,s,l){const h=s<l;for(h&&([t,n,i,e,s,l]=[i,e,t,n,l,s]);;){if(s===0&&l===0)return h?[i,e,t,n]:[t,n,i,e];if(s&l)return null;let r,a,u=s||l;u&8?(r=t+(i-t)*(this.ymax-n)/(e-n),a=this.ymax):u&4?(r=t+(i-t)*(this.ymin-n)/(e-n),a=this.ymin):u&2?(a=n+(e-n)*(this.xmax-t)/(i-t),r=this.xmax):(a=n+(e-n)*(this.xmin-t)/(i-t),r=this.xmin),s?(t=r,n=a,s=this._regioncode(t,n)):(i=r,e=a,l=this._regioncode(i,e))}}_clipInfinite(t,n,i,e,s,l){let h=Array.from(n),r;if((r=this._project(h[0],h[1],i,e))&&h.unshift(r[0],r[1]),(r=this._project(h[h.length-2],h[h.length-1],s,l))&&h.push(r[0],r[1]),h=this._clipFinite(t,h))for(let a=0,u=h.length,o,c=this._edgecode(h[u-2],h[u-1]);a<u;a+=2)o=c,c=this._edgecode(h[a],h[a+1]),o&&c&&(a=this._edge(t,o,c,h,a),u=h.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(h=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return h}_edge(t,n,i,e,s){for(;n!==i;){let l,h;switch(n){case 5:n=4;continue;case 4:n=6,l=this.xmax,h=this.ymin;break;case 6:n=2;continue;case 2:n=10,l=this.xmax,h=this.ymax;break;case 10:n=8;continue;case 8:n=9,l=this.xmin,h=this.ymax;break;case 9:n=1;continue;case 1:n=5,l=this.xmin,h=this.ymin;break}(e[s]!==l||e[s+1]!==h)&&this.contains(t,l,h)&&(e.splice(s,0,l,h),s+=2)}return s}_project(t,n,i,e){let s=1/0,l,h,r;if(e<0){if(n<=this.ymin)return null;(l=(this.ymin-n)/e)<s&&(r=this.ymin,h=t+(s=l)*i)}else if(e>0){if(n>=this.ymax)return null;(l=(this.ymax-n)/e)<s&&(r=this.ymax,h=t+(s=l)*i)}if(i>0){if(t>=this.xmax)return null;(l=(this.xmax-t)/i)<s&&(h=this.xmax,r=n+(s=l)*e)}else if(i<0){if(t<=this.xmin)return null;(l=(this.xmin-t)/i)<s&&(h=this.xmin,r=n+(s=l)*e)}return[h,r]}_edgecode(t,n){return(t===this.xmin?1:t===this.xmax?2:0)|(n===this.ymin?4:n===this.ymax?8:0)}_regioncode(t,n){return(t<this.xmin?1:t>this.xmax?2:0)|(n<this.ymin?4:n>this.ymax?8:0)}_simplify(t){if(t&&t.length>4){for(let n=0;n<t.length;n+=2){const i=(n+2)%t.length,e=(n+4)%t.length;(t[n]===t[i]&&t[i]===t[e]||t[n+1]===t[i+1]&&t[i+1]===t[e+1])&&(t.splice(i,2),n-=2)}t.length||(t=null)}return t}}const wt=2*Math.PI,O=Math.pow;function xt(d){return d[0]}function Tt(d){return d[1]}function At(d){const{triangles:t,coords:n}=d;for(let i=0;i<t.length;i+=3){const e=2*t[i],s=2*t[i+1],l=2*t[i+2];if((n[l]-n[e])*(n[s+1]-n[e+1])-(n[s]-n[e])*(n[l+1]-n[e+1])>1e-10)return!1}return!0}function Mt(d,t,n){return[d+Math.sin(d+t)*n,t+Math.cos(d-t)*n]}class J{static from(t,n=xt,i=Tt,e){return new J("length"in t?vt(t,n,i,e):Float64Array.from(kt(t,n,i,e)))}constructor(t){this._delaunator=new Q(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,n=this.points;if(t.hull&&t.hull.length>2&&At(t)){this.collinear=Int32Array.from({length:n.length/2},(c,f)=>f).sort((c,f)=>n[2*c]-n[2*f]||n[2*c+1]-n[2*f+1]);const r=this.collinear[0],a=this.collinear[this.collinear.length-1],u=[n[2*r],n[2*r+1],n[2*a],n[2*a+1]],o=1e-8*Math.hypot(u[3]-u[1],u[2]-u[0]);for(let c=0,f=n.length/2;c<f;++c){const g=Mt(n[2*c],n[2*c+1],o);n[2*c]=g[0],n[2*c+1]=g[1]}this._delaunator=new Q(n)}else delete this.collinear;const i=this.halfedges=this._delaunator.halfedges,e=this.hull=this._delaunator.hull,s=this.triangles=this._delaunator.triangles,l=this.inedges.fill(-1),h=this._hullIndex.fill(-1);for(let r=0,a=i.length;r<a;++r){const u=s[r%3===2?r-2:r+1];(i[r]===-1||l[u]===-1)&&(l[u]=r)}for(let r=0,a=e.length;r<a;++r)h[e[r]]=r;e.length<=2&&e.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=e[0],l[e[0]]=1,e.length===2&&(l[e[1]]=0,this.triangles[1]=e[1],this.triangles[2]=e[1]))}voronoi(t){return new pt(this,t)}*neighbors(t){const{inedges:n,hull:i,_hullIndex:e,halfedges:s,triangles:l,collinear:h}=this;if(h){const o=h.indexOf(t);o>0&&(yield h[o-1]),o<h.length-1&&(yield h[o+1]);return}const r=n[t];if(r===-1)return;let a=r,u=-1;do{if(yield u=l[a],a=a%3===2?a-2:a+1,l[a]!==t)return;if(a=s[a],a===-1){const o=i[(e[t]+1)%i.length];o!==u&&(yield o);return}}while(a!==r)}find(t,n,i=0){if(t=+t,t!==t||(n=+n,n!==n))return-1;const e=i;let s;for(;(s=this._step(i,t,n))>=0&&s!==i&&s!==e;)i=s;return s}_step(t,n,i){const{inedges:e,hull:s,_hullIndex:l,halfedges:h,triangles:r,points:a}=this;if(e[t]===-1||!a.length)return(t+1)%(a.length>>1);let u=t,o=O(n-a[t*2],2)+O(i-a[t*2+1],2);const c=e[t];let f=c;do{let g=r[f];const _=O(n-a[g*2],2)+O(i-a[g*2+1],2);if(_<o&&(o=_,u=g),f=f%3===2?f-2:f+1,r[f]!==t)break;if(f=h[f],f===-1){if(f=s[(l[t]+1)%s.length],f!==g&&O(n-a[f*2],2)+O(i-a[f*2+1],2)<o)return f;break}}while(f!==c);return u}render(t){const n=t==null?t=new H:void 0,{points:i,halfedges:e,triangles:s}=this;for(let l=0,h=e.length;l<h;++l){const r=e[l];if(r<l)continue;const a=s[l]*2,u=s[r]*2;t.moveTo(i[a],i[a+1]),t.lineTo(i[u],i[u+1])}return this.renderHull(t),n&&n.value()}renderPoints(t,n){n===void 0&&(!t||typeof t.moveTo!="function")&&(n=t,t=null),n=n==null?2:+n;const i=t==null?t=new H:void 0,{points:e}=this;for(let s=0,l=e.length;s<l;s+=2){const h=e[s],r=e[s+1];t.moveTo(h+n,r),t.arc(h,r,n,0,wt)}return i&&i.value()}renderHull(t){const n=t==null?t=new H:void 0,{hull:i,points:e}=this,s=i[0]*2,l=i.length;t.moveTo(e[s],e[s+1]);for(let h=1;h<l;++h){const r=2*i[h];t.lineTo(e[r],e[r+1])}return t.closePath(),n&&n.value()}hullPolygon(){const t=new R;return this.renderHull(t),t.value()}renderTriangle(t,n){const i=n==null?n=new H:void 0,{points:e,triangles:s}=this,l=s[t*=3]*2,h=s[t+1]*2,r=s[t+2]*2;return n.moveTo(e[l],e[l+1]),n.lineTo(e[h],e[h+1]),n.lineTo(e[r],e[r+1]),n.closePath(),i&&i.value()}*trianglePolygons(){const{triangles:t}=this;for(let n=0,i=t.length/3;n<i;++n)yield this.trianglePolygon(n)}trianglePolygon(t){const n=new R;return this.renderTriangle(t,n),n.value()}}function vt(d,t,n,i){const e=d.length,s=new Float64Array(e*2);for(let l=0;l<e;++l){const h=d[l];s[l*2]=t.call(i,h,l,d),s[l*2+1]=n.call(i,h,l,d)}return s}function*kt(d,t,n,i){let e=0;for(const s of d)yield t.call(i,s,e,d),yield n.call(i,s,e,d),++e}class It{constructor(t){this.duration=t}start(){this.startTime=performance.now()}get isOver(){return this.elapsedTime>this.duration}get elapsedTime(){return performance.now()-this.startTime}}const lt=(d,t,n)=>t+d*(n-t),St=d=>new Promise(t=>setTimeout(t,d));self.onmessage=d=>{const{data:{name:t,args:n}}=d;if(ht[t])return ht[t](n);console.error(`Unknown method: ${t}`)};const ht={relax:jt,stop:$t};let W;function $t(){W=!0}async function jt({points:d,image:t,steps:n}){W=!1;const e=new J(d).voronoi([0,0,t.width,t.height]),s=d.length/2,l=new Float64Array(s*2),h=new Float64Array(s),r=new It(200);r.start();for(let a=0;a<n;++a){const u=Math.pow(a+1,-.8)/100;if(d=Ft(e,l,h,t,u),self.postMessage({points:d}),r.isOver&&(r.start(),await St(0),W))break}self.postMessage({finished:!0,points:d})}function Ft(d,t,n,i,e=0){const s=d.delaunay,l=s.points,{width:h,height:r,data:a}=i;t.fill(0),n.fill(0);for(let u=0,o=0;u<r;++u)for(let c=0;c<h;++c){const f=u*h+c,g=1-a[f],_=c+.5,b=u+.5;o=s.find(_,b,o),n[o]+=g,t[o*2]+=g*_,t[o*2+1]+=g*b}for(let u=0;u<l.length/2;++u){const o=l[u*2],c=l[u*2+1],f=n[u]?t[u*2]/n[u]:o,g=n[u]?t[u*2+1]/n[u]:c;l[u*2]=lt(1.8,o,f),l[u*2+1]=lt(1.8,c,g),l[u*2]+=(Math.random()-.5)*e*h,l[u*2+1]+=(Math.random()-.5)*e*r}return d.update(),l}})();
